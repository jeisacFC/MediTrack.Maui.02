<?xml version="1.0" encoding="utf-8" ?>
<base:BaseContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="MediTrack.Frontend.Vistas.PantallasPrincipales.PantallaPerfil"
    xmlns:base="clr-namespace:MediTrack.Frontend.Vistas"
    BackgroundColor="#3b71ff"
    Title="Perfil">

    <Grid>
        <!-- Encabezado azul con patrón y botón volver -->
        <Grid HeightRequest="120" VerticalOptions="Start">
            <BoxView Color="#3b71ff" HorizontalOptions="Fill" VerticalOptions="Fill" />
            <Image Source="logo_patron.png" Aspect="AspectFill" Opacity="0.15" HorizontalOptions="Fill" VerticalOptions="Fill" />

            <!-- Botón Volver -->
            <Button Text="&lt; Volver" 
                    BackgroundColor="Transparent"
                    TextColor="White"
                    FontSize="16"
                    HorizontalOptions="Start"
                    VerticalOptions="Start"
                    Margin="20,50,0,0"
                    Command="{Binding VolverCommand}"/>

            <!-- Avatar del usuario -->
            <Frame BackgroundColor="White"
                   CornerRadius="40"
                   HeightRequest="80"
                   WidthRequest="80"
                   HorizontalOptions="Center"
                   VerticalOptions="End"
                   Margin="0,0,0,-40"
                   HasShadow="True">
                <Image Source="user_avatar.png" 
                       HeightRequest="60"
                       WidthRequest="60"
                       Aspect="AspectFill"/>
            </Frame>
        </Grid>

        <!-- Contenedor blanco desplazable -->
        <ScrollView Margin="0,80,0,0">
            <Frame CornerRadius="25" 
                   Margin="0" 
                   Padding="20,60,20,20" 
                   BackgroundColor="White" 
                   HasShadow="False">
                <VerticalStackLayout Spacing="25">

                    <!-- Información Personal -->
                    <VerticalStackLayout Spacing="15">
                        <Label Text="Información Personal" 
                               FontAttributes="Bold" 
                               FontSize="18" 
                               TextColor="#0B2B6E" 
                               Margin="0,0,0,10"/>

                        <!-- Nombre -->
                        <Grid ColumnDefinitions="Auto,*" RowSpacing="15" ColumnSpacing="20">
                            <Label Text="Nombre" 
                                   Grid.Column="0"
                                   TextColor="#666666" 
                                   FontSize="14" 
                                   VerticalOptions="Center"/>
                            <Label Text="{Binding NombreCompleto, FallbackValue='Jeremy'}" 
                                   Grid.Column="1"
                                   FontSize="16" 
                                   FontAttributes="Bold"
                                   TextColor="#0B2B6E"
                                   HorizontalOptions="End"
                                   VerticalOptions="Center"/>
                        </Grid>

                        <BoxView HeightRequest="1" BackgroundColor="#E0E0E0" HorizontalOptions="Fill"/>

                        <!-- Apellidos -->
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="20">
                            <Label Text="Apellidos" 
                                   Grid.Column="0"
                                   TextColor="#666666" 
                                   FontSize="14" 
                                   VerticalOptions="Center"/>
                            <Label Text="{Binding Apellidos, FallbackValue='Duran Vargas'}" 
                                   Grid.Column="1"
                                   FontSize="16" 
                                   FontAttributes="Bold"
                                   TextColor="#0B2B6E"
                                   HorizontalOptions="End"
                                   VerticalOptions="Center"/>
                        </Grid>

                        <BoxView HeightRequest="1" BackgroundColor="#E0E0E0" HorizontalOptions="Fill"/>

                        <!-- Fecha de nacimiento -->
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="20">
                            <Label Text="Fecha de nacimiento" 
                                   Grid.Column="0"
                                   TextColor="#666666" 
                                   FontSize="14" 
                                   VerticalOptions="Center"/>
                            <Label Text="{Binding FechaNacimientoFormateada, FallbackValue='02/11/2003'}" 
                                   Grid.Column="1"
                                   FontSize="16" 
                                   FontAttributes="Bold"
                                   TextColor="#0B2B6E"
                                   HorizontalOptions="End"
                                   VerticalOptions="Center"/>
                        </Grid>

                        <BoxView HeightRequest="1" BackgroundColor="#E0E0E0" HorizontalOptions="Fill"/>

                        <!-- Género -->
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="20">
                            <Label Text="Género" 
                                   Grid.Column="0"
                                   TextColor="#666666" 
                                   FontSize="14" 
                                   VerticalOptions="Center"/>
                            <Label Text="{Binding GeneroTexto, FallbackValue='Masculino'}" 
                                   Grid.Column="1"
                                   FontSize="16" 
                                   FontAttributes="Bold"
                                   TextColor="#0B2B6E"
                                   HorizontalOptions="End"
                                   VerticalOptions="Center"/>
                        </Grid>
                    </VerticalStackLayout>

                    <!-- Información de Contacto -->
                    <VerticalStackLayout Spacing="15">
                        <Label Text="Información de Contacto" 
                               FontAttributes="Bold" 
                               FontSize="18" 
                               TextColor="#0B2B6E" 
                               Margin="0,20,0,10"/>

                        <!-- Celular -->
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="20">
                            <Label Text="Celular" 
                                   Grid.Column="0"
                                   TextColor="#666666" 
                                   FontSize="14" 
                                   VerticalOptions="Center"/>
                            <Label Text="{Binding Telefono, FallbackValue='72386291'}" 
                                   Grid.Column="1"
                                   FontSize="16" 
                                   FontAttributes="Bold"
                                   TextColor="#0B2B6E"
                                   HorizontalOptions="End"
                                   VerticalOptions="Center"/>
                        </Grid>

                        <BoxView HeightRequest="1" BackgroundColor="#E0E0E0" HorizontalOptions="Fill"/>

                        <!-- Correo Electrónico -->
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="20">
                            <Label Text="Correo Electrónico" 
                                   Grid.Column="0"
                                   TextColor="#666666" 
                                   FontSize="14" 
                                   VerticalOptions="Center"/>
                            <Label Text="{Binding Usuario.email, FallbackValue='jeremy@meditrack.com'}" 
                                   Grid.Column="1"
                                   FontSize="16" 
                                   FontAttributes="Bold"
                                   TextColor="#0B2B6E"
                                   HorizontalOptions="End"
                                   VerticalOptions="Center"/>
                        </Grid>
                    </VerticalStackLayout>

                    <!-- Información Médica -->
                    <VerticalStackLayout Spacing="15">
                        <Label Text="Información Médica" 
                               FontAttributes="Bold" 
                               FontSize="18" 
                               TextColor="#0B2B6E" 
                               Margin="0,20,0,10"/>

                        <!-- Padecimiento -->
                        <VerticalStackLayout Spacing="10">
                            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="15">
                                <Label Text="Padecimiento" 
                                       Grid.Column="0"
                                       TextColor="#666666" 
                                       FontSize="14" 
                                       VerticalOptions="Center"/>
                                <Label Text="▼" 
                                       Grid.Column="2"
                                       TextColor="#3b71ff" 
                                       FontSize="12" 
                                       VerticalOptions="Center"/>
                            </Grid>

                            <!-- Lista expandible de padecimientos -->
                            <VerticalStackLayout Spacing="8" Margin="20,0,0,0">
                                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                                    <Label Text="▶" 
                                           Grid.Column="0"
                                           TextColor="#3b71ff" 
                                           FontSize="12" 
                                           VerticalOptions="Center"/>
                                    <Label Text="Escoliosis" 
                                           Grid.Column="1"
                                           TextColor="#0B2B6E" 
                                           FontSize="14" 
                                           VerticalOptions="Center"/>
                                </Grid>

                                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                                    <Label Text="▶" 
                                           Grid.Column="0"
                                           TextColor="#3b71ff" 
                                           FontSize="12" 
                                           VerticalOptions="Center"/>
                                    <Label Text="Diabetes" 
                                           Grid.Column="1"
                                           TextColor="#0B2B6E" 
                                           FontSize="14" 
                                           VerticalOptions="Center"/>
                                </Grid>
                            </VerticalStackLayout>
                        </VerticalStackLayout>

                        <BoxView HeightRequest="1" BackgroundColor="#E0E0E0" HorizontalOptions="Fill"/>

                        <!-- Alergias -->
                        <VerticalStackLayout Spacing="10">
                            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="15">
                                <Label Text="Alergias" 
                                       Grid.Column="0"
                                       TextColor="#666666" 
                                       FontSize="14" 
                                       VerticalOptions="Center"/>
                                <Label Text="▼" 
                                       Grid.Column="2"
                                       TextColor="#3b71ff" 
                                       FontSize="12" 
                                       VerticalOptions="Center"/>
                            </Grid>

                            <!-- Lista expandible de alergias -->
                            <VerticalStackLayout Spacing="8" Margin="20,0,0,0">
                                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                                    <Label Text="▶" 
                                           Grid.Column="0"
                                           TextColor="#3b71ff" 
                                           FontSize="12" 
                                           VerticalOptions="Center"/>
                                    <Label Text="Camarones" 
                                           Grid.Column="1"
                                           TextColor="#0B2B6E" 
                                           FontSize="14" 
                                           VerticalOptions="Center"/>
                                </Grid>

                                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                                    <Label Text="▶" 
                                           Grid.Column="0"
                                           TextColor="#3b71ff" 
                                           FontSize="12" 
                                           VerticalOptions="Center"/>
                                    <Label Text="Maní" 
                                           Grid.Column="1"
                                           TextColor="#0B2B6E" 
                                           FontSize="14" 
                                           VerticalOptions="Center"/>
                                </Grid>
                            </VerticalStackLayout>
                        </VerticalStackLayout>
                    </VerticalStackLayout>

                    <!-- Configuración -->
                    <VerticalStackLayout Spacing="15">
                        <Label Text="Configuración" 
                               FontAttributes="Bold" 
                               FontSize="18" 
                               TextColor="#0B2B6E" 
                               Margin="0,20,0,10"/>

                        <!-- Notificaciones Push -->
                        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="15">
                            <Label Text="Notificaciones Push" 
                                   Grid.Column="0"
                                   TextColor="#666666" 
                                   FontSize="14" 
                                   VerticalOptions="Center"/>
                            <Switch Grid.Column="2"
                                    IsToggled="{Binding Usuario.notificaciones_push}"
                                    OnColor="#3b71ff"
                                    ThumbColor="White"
                                    Toggled="OnToggleNotificaciones"/>
                        </Grid>
                    </VerticalStackLayout>

                    <!-- Botones de Acción -->
                    <VerticalStackLayout Spacing="15" Margin="0,30,0,0">
                        <Button Text="Editar Perfil" 
                                Command="{Binding EditarPerfilCommand}"
                                BackgroundColor="#3b71ff" 
                                TextColor="White" 
                                CornerRadius="25" 
                                HeightRequest="50"
                                FontSize="16"
                                FontAttributes="Bold"/>

                        <Button Text="Cerrar Sesión" 
                                Command="{Binding CerrarSesionCommand}"
                                BackgroundColor="Transparent" 
                                TextColor="#dc3545" 
                                BorderColor="#dc3545"
                                BorderWidth="1"
                                CornerRadius="25" 
                                HeightRequest="50"
                                FontSize="16"/>
                    </VerticalStackLayout>

                    <!-- Indicador de Carga -->
                    <ActivityIndicator IsRunning="{Binding IsBusy}" 
                                      IsVisible="{Binding IsBusy}"
                                      Color="#3b71ff" 
                                      VerticalOptions="Center" 
                                      HorizontalOptions="Center"
                                      HeightRequest="40"/>

                    <!-- Mensaje de Error -->
                    <Label Text="{Binding ErrorMessage}" 
                           IsVisible="{Binding HasError}"
                           TextColor="#dc3545" 
                           FontSize="14" 
                           HorizontalOptions="Center"
                           Margin="0,10,0,0"/>

                    <!-- Espaciado inferior -->
                    <BoxView HeightRequest="20" BackgroundColor="Transparent"/>

                </VerticalStackLayout>
            </Frame>
        </ScrollView>
    </Grid>
</base:BaseContentPage>