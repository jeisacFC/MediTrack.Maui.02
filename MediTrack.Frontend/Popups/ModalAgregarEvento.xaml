<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:MediTrack.Frontend.ViewModels.PantallasPrincipales"
             x:Class="MediTrack.Frontend.Vistas.PantallasPrincipales.ModalAgregarEvento"
             BackgroundColor="Transparent"
             Title="{Binding Title}">

    <!-- Fondo semi-transparente con gesture -->
    <Grid BackgroundColor="#80000000">
        <Grid.GestureRecognizers>
            <TapGestureRecognizer Command="{Binding FondoTappedCommand}" />
        </Grid.GestureRecognizers>

        <!-- Modal flotante centrado -->
        <Frame BackgroundColor="White"
               CornerRadius="20"
               HasShadow="True"
               Margin="30"
               Padding="0"
               VerticalOptions="Center"
               HorizontalOptions="Fill"
               MaximumHeightRequest="500">

            <ScrollView>
                <VerticalStackLayout Spacing="0">

                    <!-- Header compacto -->
                    <Frame BackgroundColor="#007AFF" 
                           CornerRadius="20" 
                           Padding="20,15"
                           Margin="0"
                           HasShadow="False">
                        <VerticalStackLayout Spacing="3">
                            <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                                <Label FontFamily="MaterialIcons"
                                       Text="&#xe145;"
                                       FontSize="20"
                                       TextColor="White"
                                       VerticalOptions="Center" />
                                <Label Text="{Binding Title}"
                                       FontSize="18"
                                       FontAttributes="Bold"
                                       TextColor="White"
                                       VerticalOptions="Center" />
                            </HorizontalStackLayout>
                            <Label Text="{Binding FechaFormateada}"
                                   FontSize="13"
                                   TextColor="White"
                                   HorizontalTextAlignment="Center"
                                   Opacity="0.9" />
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Contenido compacto -->
                    <VerticalStackLayout Spacing="15" Padding="20">

                        <!-- Campo: Nombre del evento -->
                        <VerticalStackLayout Spacing="5">
                            <HorizontalStackLayout Spacing="8">
                                <Label FontFamily="MaterialIcons"
                                       Text="&#xe3c9;"
                                       FontSize="16"
                                       TextColor="#007AFF"
                                       VerticalOptions="Center" />
                                <Label Text="Nombre"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="#333"
                                       VerticalOptions="Center" />
                            </HorizontalStackLayout>
                            <Frame BackgroundColor="#F8F9FA" 
                                   CornerRadius="10" 
                                   Padding="12"
                                   HasShadow="False"
                                   BorderColor="Transparent">
                                <Entry Text="{Binding NombreEvento}"
                                       Placeholder="Ej: Tomar medicamento..."
                                       FontSize="14"
                                       BackgroundColor="Transparent"
                                       PlaceholderColor="#999"
                                       TextColor="#333" />
                            </Frame>
                        </VerticalStackLayout>

                        <!-- Campos en fila: Hora y Tipo -->
                        <Grid ColumnDefinitions="*,10,*" RowSpacing="5">

                            <!-- Horario -->
                            <VerticalStackLayout Grid.Column="0" Spacing="5">
                                <HorizontalStackLayout Spacing="8">
                                    <Label FontFamily="MaterialIcons"
                                           Text="&#xe8b5;"
                                           FontSize="16"
                                           TextColor="#007AFF"
                                           VerticalOptions="Center" />
                                    <Label Text="Hora"
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           TextColor="#333"
                                           VerticalOptions="Center" />
                                </HorizontalStackLayout>
                                <Frame BackgroundColor="#F8F9FA" 
                                       CornerRadius="10" 
                                       Padding="12"
                                       HasShadow="False"
                                       BorderColor="Transparent">
                                    <TimePicker Time="{Binding HoraEvento}"
                                               FontSize="14"
                                               BackgroundColor="Transparent"
                                               TextColor="#333" />
                                </Frame>
                            </VerticalStackLayout>

                            <!-- Tipo -->
                            <VerticalStackLayout Grid.Column="2" Spacing="5">
                                <HorizontalStackLayout Spacing="8">
                                    <Label FontFamily="MaterialIcons"
                                           Text="&#xe892;"
                                           FontSize="16"
                                           TextColor="#007AFF"
                                           VerticalOptions="Center" />
                                    <Label Text="Tipo"
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           TextColor="#333"
                                           VerticalOptions="Center" />
                                </HorizontalStackLayout>
                                <Frame BackgroundColor="#F8F9FA" 
                                       CornerRadius="10" 
                                       Padding="0"
                                       HasShadow="False"
                                       BorderColor="Transparent">
                                    <Grid ColumnDefinitions="*,Auto" Padding="12,0">
                                        <Picker ItemsSource="{Binding TiposEvento}"
                                               SelectedItem="{Binding TipoSeleccionado}"
                                               Grid.Column="0"
                                               FontSize="14"
                                               BackgroundColor="Transparent"
                                               TextColor="#333"
                                               VerticalOptions="Center" />
                                        <Label Grid.Column="1"
                                               FontFamily="MaterialIcons"
                                               Text="&#xe5c5;"
                                               FontSize="16"
                                               TextColor="#999"
                                               VerticalOptions="Center"
                                               Margin="0,0,8,0" />
                                    </Grid>
                                </Frame>
                            </VerticalStackLayout>
                        </Grid>

                        <!-- Campo: Descripción (opcional y más pequeño) -->
                        <VerticalStackLayout Spacing="5">
                            <HorizontalStackLayout Spacing="8">
                                <Label FontFamily="MaterialIcons"
                                       Text="&#xe865;"
                                       FontSize="16"
                                       TextColor="#007AFF"
                                       VerticalOptions="Center" />
                                <Label Text="Descripción (opcional)"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="#333"
                                       VerticalOptions="Center" />
                            </HorizontalStackLayout>
                            <Frame BackgroundColor="#F8F9FA" 
                                   CornerRadius="10" 
                                   Padding="12"
                                   HasShadow="False"
                                   BorderColor="Transparent">
                                <Editor Text="{Binding DescripcionEvento}"
                                       Placeholder="Detalles adicionales..."
                                       FontSize="14"
                                       BackgroundColor="Transparent"
                                       PlaceholderColor="#999"
                                       TextColor="#333"
                                       HeightRequest="60" />
                            </Frame>
                        </VerticalStackLayout>

                        <!-- Botones compactos -->
                        <Grid ColumnDefinitions="*,10,*" Margin="0,10,0,0">

                            <!-- Botón Cancelar -->
                            <Button Grid.Column="0"
                                    Text="Cancelar"
                                    Command="{Binding CancelarCommand}"
                                    BackgroundColor="#E5E7EB"
                                    TextColor="#6B7280"
                                    CornerRadius="12"
                                    FontSize="14"
                                    FontAttributes="Bold"
                                    HeightRequest="44" />

                            <!-- Botón Guardar -->
                            <Button Grid.Column="2"
                                    Text="Guardar"
                                    Command="{Binding GuardarCommand}"
                                    BackgroundColor="#007AFF"
                                    TextColor="White"
                                    CornerRadius="12"
                                    FontSize="14"
                                    FontAttributes="Bold"
                                    HeightRequest="44"
                                    IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBoolConverter}}" />

                        </Grid>

                        <!-- Loading indicator -->
                        <ActivityIndicator IsVisible="{Binding IsLoading}"
                                          IsRunning="{Binding IsLoading}"
                                          Color="#007AFF"
                                          Margin="0,10,0,0" />

                    </VerticalStackLayout>
                </VerticalStackLayout>
            </ScrollView>
        </Frame>
    </Grid>

</ContentPage>