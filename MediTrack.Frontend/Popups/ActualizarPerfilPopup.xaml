<?xml version="1.0" encoding="utf-8" ?>
<toolkit:Popup xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
               xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
               xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
               x:Class="MediTrack.Frontend.Popups.ActualizarPerfilPopup"
               Color="Transparent">

    <ScrollView>
        <Frame CornerRadius="25" 
               Padding="25" 
               Margin="20" 
               BackgroundColor="White"
               VerticalOptions="Center" 
               HorizontalOptions="Center"
               WidthRequest="350"
               HasShadow="True">

            <VerticalStackLayout Spacing="20">

                <!-- Header -->
                <Grid ColumnDefinitions="*,Auto">
                    <Label Text="Actualizar Perfil" 
                           Grid.Column="0"
                           FontSize="20" 
                           FontAttributes="Bold" 
                           TextColor="#0B2B6E"
                           VerticalOptions="Center"/>

                    <Button Grid.Column="1"
                            BackgroundColor="#dc3545"
                            TextColor="White"
                            CornerRadius="15"
                            HeightRequest="30"
                            WidthRequest="30"
                            FontSize="16"
                            Clicked="OnCerrarClicked">
                        <Button.ImageSource>
                            <FontImageSource Glyph="&#xE5CD;" FontFamily="MaterialIcons" Color="White" Size="16"/>
                        </Button.ImageSource>
                    </Button>
                </Grid>

                <!-- Separador -->
                <BoxView BackgroundColor="#e9ecef" HeightRequest="1" HorizontalOptions="Fill"/>

                <!-- Formulario -->
                <VerticalStackLayout Spacing="15">

                    <!-- Nombre -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Nombre *" 
                               TextColor="#495057" 
                               FontAttributes="Bold"
                               FontSize="14"/>
                        <Frame BackgroundColor="#f8f9fa" 
                               CornerRadius="12" 
                               Padding="0" 
                               HasShadow="False"
                               BorderColor="#dee2e6">
                            <Entry x:Name="EntryNombre"
                                   Text="{Binding Nombre}"
                                   Placeholder="Ingresa tu nombre"
                                   BackgroundColor="Transparent"
                                   TextColor="#212529"
                                   PlaceholderColor="#6c757d"
                                   FontSize="14"/>
                        </Frame>
                        <Label Text="{Binding ErrorNombre}" 
                               TextColor="#dc3545" 
                               FontSize="12"
                               IsVisible="{Binding TieneErrorNombre}"/>
                    </VerticalStackLayout>

                    <!-- Primer Apellido -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Primer Apellido *" 
                               TextColor="#495057" 
                               FontAttributes="Bold"
                               FontSize="14"/>
                        <Frame BackgroundColor="#f8f9fa" 
                               CornerRadius="12" 
                               Padding="0" 
                               HasShadow="False"
                               BorderColor="#dee2e6">
                            <Entry x:Name="EntryApellido1"
                                   Text="{Binding Apellido1}"
                                   Placeholder="Ingresa tu primer apellido"
                                   BackgroundColor="Transparent"
                                   TextColor="#212529"
                                   PlaceholderColor="#6c757d"
                                   FontSize="14"/>
                        </Frame>
                        <Label Text="{Binding ErrorApellido1}" 
                               TextColor="#dc3545" 
                               FontSize="12"
                               IsVisible="{Binding TieneErrorApellido1}"/>
                    </VerticalStackLayout>

                    <!-- Segundo Apellido -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Segundo Apellido" 
                               TextColor="#495057" 
                               FontAttributes="Bold"
                               FontSize="14"/>
                        <Frame BackgroundColor="#f8f9fa" 
                               CornerRadius="12" 
                               Padding="0" 
                               HasShadow="False"
                               BorderColor="#dee2e6">
                            <Entry x:Name="EntryApellido2"
                                   Text="{Binding Apellido2}"
                                   Placeholder="Ingresa tu segundo apellido (opcional)"
                                   BackgroundColor="Transparent"
                                   TextColor="#212529"
                                   PlaceholderColor="#6c757d"
                                   FontSize="14"/>
                        </Frame>
                    </VerticalStackLayout>

                    <!-- Fecha de Nacimiento -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Fecha de Nacimiento" 
                               TextColor="#495057" 
                               FontAttributes="Bold"
                               FontSize="14"/>
                        <Frame BackgroundColor="#f8f9fa" 
                               CornerRadius="12" 
                               Padding="0" 
                               HasShadow="False"
                               BorderColor="#dee2e6">
                            <DatePicker x:Name="DatePickerFechaNacimiento"
                                        Date="{Binding FechaNacimiento}"
                                        BackgroundColor="Transparent"
                                        TextColor="#212529"
                                        FontSize="14"
                                        MinimumDate="01/01/1900"
                                        MaximumDate="{Binding FechaMaxima}"/>
                        </Frame>
                        <Label Text="{Binding ErrorFechaNacimiento}" 
                               TextColor="#dc3545" 
                               FontSize="12"
                               IsVisible="{Binding TieneErrorFechaNacimiento}"/>
                    </VerticalStackLayout>

                    <!-- Género -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Género" 
                               TextColor="#495057" 
                               FontAttributes="Bold"
                               FontSize="14"/>
                        <Frame BackgroundColor="#f8f9fa" 
                               CornerRadius="12" 
                               Padding="0" 
                               HasShadow="False"
                               BorderColor="#dee2e6">
                            <Picker x:Name="PickerGenero"
                                    ItemsSource="{Binding OpcionesGenero}"
                                    ItemDisplayBinding="{Binding Texto}"
                                    SelectedItem="{Binding GeneroSeleccionado}"
                                    BackgroundColor="Transparent"
                                    TextColor="#212529"
                                    FontSize="14"
                                    Title="Selecciona tu género"/>
                        </Frame>
                    </VerticalStackLayout>

                </VerticalStackLayout>

                <!-- Botones -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="15" Margin="0,10,0,0">

                    <Button Grid.Column="0"
                            Text="Cancelar"
                            BackgroundColor="#6c757d"
                            TextColor="White"
                            CornerRadius="15"
                            HeightRequest="45"
                            FontSize="14"
                            FontAttributes="Bold"
                            Clicked="OnCancelarClicked"/>

                    <Button Grid.Column="1"
                            Text="{Binding TextoBotonGuardar}"
                            BackgroundColor="#3b71ff"
                            TextColor="White"
                            CornerRadius="15"
                            HeightRequest="45"
                            FontSize="14"
                            FontAttributes="Bold"
                            IsEnabled="{Binding PuedeGuardar}"
                            Command="{Binding GuardarCommand}">
                        <Button.Triggers>
                            <DataTrigger TargetType="Button" Binding="{Binding EstaGuardando}" Value="True">
                                <Setter Property="BackgroundColor" Value="#adb5bd"/>
                            </DataTrigger>
                        </Button.Triggers>
                    </Button>

                </Grid>

                <!-- Indicador de carga -->
                <StackLayout Orientation="Horizontal" 
                             Spacing="10" 
                             HorizontalOptions="Center"
                             IsVisible="{Binding EstaGuardando}">
                    <ActivityIndicator IsRunning="True" 
                                       Color="#3b71ff" 
                                       HeightRequest="20" 
                                       WidthRequest="20"/>
                    <Label Text="Actualizando perfil..." 
                           TextColor="#3b71ff" 
                           FontSize="14"
                           VerticalOptions="Center"/>
                </StackLayout>

            </VerticalStackLayout>
        </Frame>
    </ScrollView>
</toolkit:Popup>