<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:viewModels="clr-namespace:MediTrack.Frontend.ViewModels.PantallasInicio"
    x:Class="MediTrack.Frontend.Popups.ModalCodigoVerificacion"
    BackgroundColor="Transparent"
    NavigationPage.HasNavigationBar="False">

    <!-- Overlay semi-transparente -->
    <Grid BackgroundColor="#80000000">

        <!-- Modal centrado -->
        <Frame BackgroundColor="White"
               CornerRadius="20"
               HasShadow="True"
               Padding="30"
               Margin="40,0"
               VerticalOptions="Center"
               HorizontalOptions="Center"
               MaximumWidthRequest="400"
               MaximumHeightRequest="505">

            <VerticalStackLayout Spacing="20">

                <!-- Header con icono y título -->
                <VerticalStackLayout Spacing="10" HorizontalOptions="Center">
                    <Image>
                        <Image.Source>
                            <FontImageSource Glyph="&#xe0be;"
                           FontFamily="MaterialIcons"
                           Color="#3B71FF"
                           Size="40"/>
                        </Image.Source>
                    </Image>

                    <Label Text="Verificar código"
           FontSize="24"
           FontAttributes="Bold"
           TextColor="#3B71FF"
           HorizontalOptions="Center"/>

                    <Label Text="{Binding EmailUsuario, StringFormat='Código enviado a {0}'}"
           FontSize="14"
           TextColor="Gray"
           HorizontalTextAlignment="Center"/>
                </VerticalStackLayout>

                <!-- Mensaje de estado -->
                <Label Text="{Binding MensajeEstado}"
                       TextColor="#3B71FF"
                       FontSize="14"
                       HorizontalOptions="Center"
                       IsVisible="{Binding MensajeEstado, Converter={StaticResource StringNotEmptyConverter}}"/>

                <!-- Campo de código con diseño especial -->
                <VerticalStackLayout Spacing="10">
                    <Label Text="Ingresa el código de 6 dígitos:"
                           TextColor="Black"
                           FontSize="16"
                           HorizontalOptions="Center"/>

                    <Frame CornerRadius="12"
                           BackgroundColor="#F8F8F8"
                           HasShadow="False"
                           Padding="15">
                        <HorizontalStackLayout HorizontalOptions="Center">
                            <Image>
                                <Image.Source>
                                    <FontImageSource Glyph="&#xe32a;"
                                                   FontFamily="MaterialIcons"
                                                   Color="#3B71FF"
                                                   Size="20"/>
                                </Image.Source>
                            </Image>
                            <Entry x:Name="CodigoEntry"
                                   Text="{Binding Codigo}"
                                   Placeholder="123456"
                                   Keyboard="Numeric"
                                   MaxLength="6"
                                   PlaceholderColor="#A0A0A0"
                                   TextColor="Black"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   HorizontalTextAlignment="Center"
                                   IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                                   Margin="10,0"
                                   WidthRequest="120"/>
                        </HorizontalStackLayout>
                    </Frame>
                </VerticalStackLayout>

                <!-- Botones -->
                <VerticalStackLayout Spacing="15">

                    <!-- Botón Verificar -->
                    <Button Text="Verificar código"
                            Command="{Binding VerificarCodigoCommand}"
                            FontSize="16"
                            BackgroundColor="#3B71FF"
                            TextColor="White"
                            CornerRadius="12"
                            HeightRequest="45"
                            IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                            Clicked="VerificarCodigo">
                        <Button.Triggers>
                            <DataTrigger TargetType="Button" Binding="{Binding IsLoading}" Value="True">
                                <Setter Property="Text" Value="Verificando..." />
                            </DataTrigger>
                        </Button.Triggers>
                    </Button>

                    <!-- Botón Reenviar código -->
                    <Button Text="Reenviar código"
                            Command="{Binding ReenviarCodigoCommand}"
                            BackgroundColor="Transparent"
                            TextColor="#3B71FF"
                            FontAttributes="Bold"
                            FontSize="14"
                            IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                            Clicked="ReenviarCodigo"/>

                </VerticalStackLayout>

                <!-- Divider -->
                <BoxView HeightRequest="1"
                         BackgroundColor="#E0E0E0"
                         Margin="0,10"/>

                <!-- Botón Cancelar -->
                <Button Text="Cancelar"
                        Command="{Binding CerrarModalCommand}"
                        BackgroundColor="Transparent"
                        TextColor="Gray"
                        FontSize="14"
                        IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                        Clicked="CerrarModal"/>

            </VerticalStackLayout>
        </Frame>
    </Grid>
</ContentPage>